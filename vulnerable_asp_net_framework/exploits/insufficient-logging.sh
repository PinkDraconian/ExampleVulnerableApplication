#!/bin/bash

function get_log(){
    curl -v -X GET "http://localhost:49851/InsufficientLogging?showlogs=1" 2>&1 | sed "s/<\/br>/\n/g" | grep ":\["
} 

OLDLOG="$(get_log)"
./sensitive_data_exposure.sh
NEWLOG="$(get_log)"

echo -e "log before breach is: \n$OLDLOG"
echo -e "log after breach is: \n$NEWLOG"

[ "$OLDLOG" == "$NEWLOG" ] && exit 0

exit 1
